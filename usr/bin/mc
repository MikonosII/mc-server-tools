#!/usr/bin/env bash
set -euo pipefail

ROOT="/usr/share/mc-server-tools"
PATH="$ROOT/commands:$PATH"

usage() {
  cat <<'EOF'
mc-server-tools

Usage: mc <command> [args]

Commands:
  setup           Create a new Minecraft server container
  start CTID      Start server
  stop CTID       Stop server
  restart CTID    Restart server
  logs CTID       Tail logs
  console CTID    Attach to console
  backup CTID     Run backup immediately (vzdump)
  delete CTID     Stop and remove container
  list            Show servers created by mc-server-tools
  clone SRC DST   Create new CT DST from SRC; auto-detect Java/Bedrock and copy worlds

Examples:
  mc setup
  mc start 101
EOF
}

cmd=${1:-help}
shift || true

case "$cmd" in
  setup)    exec "$ROOT/commands/mc-setup"   "$@" ;;
  start)    exec "$ROOT/commands/mc-start"   "$@" ;;
  stop)     exec "$ROOT/commands/mc-stop"    "$@" ;;
  restart)  exec "$ROOT/commands/mc-restart" "$@" ;;
  logs)     exec "$ROOT/commands/mc-logs"    "$@" ;;
  console)  exec "$ROOT/commands/mc-console" "$@" ;;
  backup)   exec "$ROOT/commands/mc-backup"  "$@" ;;
  delete)   exec "$ROOT/commands/mc-delete"  "$@" ;;
  list)     exec "$ROOT/commands/mc-list"    "$@" ;;
  clone)    exec "$ROOT/commands/mc-clone"   "$@" ;;
  -h|--help|help) usage ;;
  *) echo "Unknown command: $cmd" >&2; usage; exit 1 ;;
esac
